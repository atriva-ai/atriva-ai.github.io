---
import SidebarItem from "@/components/docs/SidebarItem.astro";
import { docsSidebar } from "@/config/docsSidebar";
import { Icon } from "astro-icon/components";

const currentPath = Astro.url.pathname;
---

<!-- Mobile Menu Button -->
<button
  id="mobile-sidebar-toggle"
  type="button"
  class="md:hidden fixed bottom-6 right-6 z-40 w-14 h-14 bg-[#48A18D] text-white rounded-full shadow-lg shadow-[#48A18D]/25 flex items-center justify-center hover:bg-[#3b8675] transition-colors"
  aria-label="Open navigation menu"
  aria-expanded="false"
  aria-controls="mobile-sidebar"
>
  <Icon name="bx:bx-menu" class="w-6 h-6 menu-icon" />
  <Icon name="bx:bx-x" class="w-6 h-6 close-icon hidden" />
</button>

<!-- Mobile Sidebar Overlay -->
<div
  id="mobile-sidebar-overlay"
  class="md:hidden fixed inset-0 z-40 bg-black/50 backdrop-blur-sm opacity-0 pointer-events-none transition-opacity duration-300"
  aria-hidden="true"
></div>

<!-- Mobile Sidebar Drawer -->
<aside
  id="mobile-sidebar"
  class="md:hidden fixed inset-y-0 left-0 z-50 w-80 max-w-[85vw] bg-white shadow-2xl transform -translate-x-full transition-transform duration-300 ease-out"
  aria-label="Mobile navigation"
>
  <!-- Header -->
  <div class="flex items-center justify-between px-4 py-4 border-b border-slate-200">
    <span class="font-semibold text-slate-900">Documentation</span>
    <button
      id="mobile-sidebar-close"
      type="button"
      class="w-8 h-8 flex items-center justify-center rounded-lg hover:bg-slate-100 text-slate-500 hover:text-slate-700 transition-colors"
      aria-label="Close navigation menu"
    >
      <Icon name="bx:bx-x" class="w-5 h-5" />
    </button>
  </div>

  <!-- Sidebar Content -->
  <nav class="overflow-y-auto h-[calc(100vh-4rem)] px-4 py-4">
    <ul>
      {docsSidebar.map(item => (
        <SidebarItem item={item} currentPath={currentPath} />
      ))}
    </ul>
  </nav>
</aside>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const toggleBtn = document.getElementById('mobile-sidebar-toggle');
    const closeBtn = document.getElementById('mobile-sidebar-close');
    const sidebar = document.getElementById('mobile-sidebar');
    const overlay = document.getElementById('mobile-sidebar-overlay');
    const menuIcon = toggleBtn?.querySelector('.menu-icon');
    const closeIcon = toggleBtn?.querySelector('.close-icon');

    function openSidebar() {
      sidebar?.classList.remove('-translate-x-full');
      overlay?.classList.remove('opacity-0', 'pointer-events-none');
      toggleBtn?.setAttribute('aria-expanded', 'true');
      menuIcon?.classList.add('hidden');
      closeIcon?.classList.remove('hidden');
      document.body.style.overflow = 'hidden';
    }

    function closeSidebar() {
      sidebar?.classList.add('-translate-x-full');
      overlay?.classList.add('opacity-0', 'pointer-events-none');
      toggleBtn?.setAttribute('aria-expanded', 'false');
      menuIcon?.classList.remove('hidden');
      closeIcon?.classList.add('hidden');
      document.body.style.overflow = '';
    }

    toggleBtn?.addEventListener('click', () => {
      const isExpanded = toggleBtn.getAttribute('aria-expanded') === 'true';
      if (isExpanded) {
        closeSidebar();
      } else {
        openSidebar();
      }
    });

    closeBtn?.addEventListener('click', closeSidebar);
    overlay?.addEventListener('click', closeSidebar);

    // Close on escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closeSidebar();
      }
    });

    // Close sidebar when clicking a link (for navigation)
    sidebar?.querySelectorAll('a').forEach(link => {
      link.addEventListener('click', () => {
        closeSidebar();
      });
    });
  });
</script>

